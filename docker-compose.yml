services:
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        FRONTEND_API_BASE: ${FRONTEND_API_BASE:-http://localhost:4000}
        FRONTEND_ADMIN_TOKEN: ${FRONTEND_ADMIN_TOKEN:-devhub-local-admin-token}
    ports:
      - "${FRONTEND_PORT:-4173}:4173"
    depends_on:
      - backend
    restart: unless-stopped

  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
      args:
        DATABASE_URL: ${DATABASE_URL:-file:./dev.db}
    ports:
      - "${PORT:-4000}:4000"
    env_file:
      - ./server/.env
    environment:
      PORT: ${PORT:-4000}
      API_ADMIN_TOKEN: ${API_ADMIN_TOKEN:-devhub-local-admin-token}
      SERVE_STATIC_ASSETS: ${SERVE_STATIC_ASSETS:-false}
      CORS_ALLOWED_ORIGINS: ${CORS_ALLOWED_ORIGINS:-http://localhost:4173}
      API_PROXY_ALLOWLIST: ${API_PROXY_ALLOWLIST:-localhost}
    volumes:
      - ./server/dev.db:/app/server/dev.db
      - ./server/scripts:/app/server/scripts
      - ./server/src:/app/server/src
      - ./server/prisma:/app/server/prisma
      - ./server/tsconfig.json:/app/server/tsconfig.json
      - ./server/tsconfig.scripts.json:/app/server/tsconfig.scripts.json
    restart: unless-stopped

volumes:
  devhub_data: {}
